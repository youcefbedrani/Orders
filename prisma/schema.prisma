// Prisma schema for YouCan Order Automation

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String?
  createdAt DateTime @default(now())
  role      String   @default("USER") // 'USER', 'ADMIN', 'BLOCKED'
  jobs      Job[]
  campaigns Campaign[]
}

model Job {
  id             String   @id @default(cuid())
  userId         String
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  landingPageUrl String
  fileName       String
  columnMapping  String   // JSON string
  status         String   @default("pending") // pending, processing, completed, failed, stopped
  totalOrders    Int      @default(0)
  successCount   Int      @default(0)
  failedCount    Int      @default(0)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  orders         Order[]
}

model Order {
  id           String   @id @default(cuid())
  jobId        String
  job          Job      @relation(fields: [jobId], references: [id], onDelete: Cascade)
  customerName String
  phone        String
  status       String   @default("pending") // pending, success, failed
  errorMsg     String?
  createdAt    DateTime @default(now())
}

model Campaign {
  id           String   @id @default(cuid())
  url          String
  orderCount   Int
  successCount Int
  failedCount  Int
  successRate  Float
  duration     Int      // in seconds
  mode         String   // 'random' or 'excel'
  fileName     String?  // Name of the Excel file used (if any)
  createdAt    DateTime @default(now())
  userId       String?
  user         User?    @relation(fields: [userId], references: [id], onDelete: SetNull)
}
